- name: Deploy to build-branch (From Scratch)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Configure Git Identity (Uses a generic bot identity)
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # 2. Navigate into the build output directory
          # This is the crucial step: We make 'out' the root of our new repo
          cd out

          # 3. Initialize a fresh git repository inside 'out'
          git init

          # 4. Stage and Commit all files
          git add -A
          git commit -m "Deploying build from commit ${{ github.sha }}"

          # 5. Force Push to the target branch
          # -f (force) overwrites the history of 'build-branch' so it only contains this latest build
          # HEAD:build-branch means "push the current commit (HEAD) to the remote branch named 'build-branch'"
          git push -f https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git HEAD:build-branch